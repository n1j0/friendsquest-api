name: Deployment Staging/Production

on:
  pull_request_target:
    types:
      - closed
    branches:
      - develop

jobs:
  deploy:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: add SSH information
      env:
          SSH_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
      run: |
        mkdir -p ~/.ssh/
        echo "$SSH_KEY" > ~/.ssh/id_rsa
        chmod 600 ~/.ssh/id_rsa
        cat >> ~/.ssh/config <<END
        Host projects.multimediatechnology.at
          IdentityFile ~/.ssh/id_rsa
        END
    - name: git push to staging system
      # if: github.ref_name == 'develop'
      run: |
        git remote add staging ssh://dokku@projects.multimediatechnology.at:5412/friendsqueststaging
        git config --global user.name "GitHub Deployment"
        git config --global user.email "nijo@duck.com"
        git push staging develop:master
    #- name: git push to production system
    #  if: github.ref_name == 'main'
    #  run: |
    #    git remote add production ssh://dokku@projects.multimediatechnology.at:5412/friendsquest
    #    git config --global user.name "GitHub Deployment"
    #    git config --global user.email "nijo@duck.com"
    #    git push production main:main
